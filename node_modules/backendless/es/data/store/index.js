"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _applyDecoratedDescriptor2 = _interopRequireDefault(require("@babel/runtime/helpers/applyDecoratedDescriptor"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _utils = _interopRequireDefault(require("../../utils"));

var _decorators = require("../../decorators");

var _rtStore = _interopRequireDefault(require("../rt-store"));

var _relations = require("./relations");

var _bulk = require("./bulk");

var _find = require("./find");

var _save = require("./save");

var _remove = require("./remove");

var _count = require("./count");

var _parse = require("./parse");

var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _dec12, _dec13, _dec14, _obj, _init, _init2, _init3, _init4, _init5, _init6, _init7, _init8, _init9, _init10, _init11, _init12, _init13, _init14;

//TODO: will be removed when remove sync methods
var namespaceLabel = 'Backendless.Data.of(<ClassName>)';

var DataStore = /*#__PURE__*/function () {
  function DataStore(model, classToTableMap, app) {
    (0, _classCallCheck2["default"])(this, DataStore);
    this.classToTableMap = classToTableMap;

    if (typeof model === 'string') {
      this.className = model;
      this.model = this.classToTableMap[this.className];
    } else {
      this.className = _utils["default"].getClassName(model);
      this.model = this.classToTableMap[this.className] || model;
    }

    if (!this.className) {
      throw new Error('Class name should be specified');
    }

    this.app = app;
  }

  (0, _createClass2["default"])(DataStore, [{
    key: "rt",
    value: function rt() {
      return this.eventHandler = this.eventHandler || new _rtStore["default"](this, this.app);
    }
  }, {
    key: "parseFindResponse",
    value: function parseFindResponse(result, model) {
      return (0, _parse.parseFindResponse)(result, model || this.model, this.classToTableMap);
    }
  }]);
  return DataStore;
}();

(0, _extends2["default"])(DataStore.prototype, (_dec = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".save")), _dec2 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".remove")), _dec3 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".find")), _dec4 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".findById")), _dec5 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".loadRelations")), _dec6 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".findFirst")), _dec7 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".findLast")), _dec8 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".getObjectCount")), _dec9 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".setRelation")), _dec10 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".addRelation")), _dec11 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".deleteRelation")), _dec12 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".bulkCreate")), _dec13 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".bulkUpdate")), _dec14 = (0, _decorators.deprecated)(namespaceLabel, "".concat(namespaceLabel, ".bulkDelete")), (_obj = {
  saveSync: _utils["default"]["synchronized"](_save.save),
  save: _utils["default"].promisified(_save.save),
  removeSync: _utils["default"]["synchronized"](_remove.remove),
  remove: _utils["default"].promisified(_remove.remove),
  findSync: _utils["default"]["synchronized"](_find.find),
  find: _utils["default"].promisified(_find.find),
  findByIdSync: _utils["default"]["synchronized"](_find.findById),
  findById: _utils["default"].promisified(_find.findById),
  loadRelationsSync: _utils["default"]["synchronized"](_relations.loadRelations),
  loadRelations: _utils["default"].promisified(_relations.loadRelations),
  findFirstSync: _utils["default"]["synchronized"](_find.findFirst),
  findFirst: _utils["default"].promisified(_find.findFirst),
  findLastSync: _utils["default"]["synchronized"](_find.findLast),
  findLast: _utils["default"].promisified(_find.findLast),
  getObjectCountSync: _utils["default"]["synchronized"](_count.getObjectCount),
  getObjectCount: _utils["default"].promisified(_count.getObjectCount),
  setRelationSync: _utils["default"]["synchronized"](_relations.setRelation),
  setRelation: _utils["default"].promisified(_relations.setRelation),
  addRelationSync: _utils["default"]["synchronized"](_relations.addRelation),
  addRelation: _utils["default"].promisified(_relations.addRelation),
  deleteRelationSync: _utils["default"]["synchronized"](_relations.deleteRelation),
  deleteRelation: _utils["default"].promisified(_relations.deleteRelation),
  bulkCreateSync: _utils["default"]["synchronized"](_bulk.bulkCreate),
  bulkCreate: _utils["default"].promisified(_bulk.bulkCreate),
  bulkUpdateSync: _utils["default"]["synchronized"](_bulk.bulkUpdate),
  bulkUpdate: _utils["default"].promisified(_bulk.bulkUpdate),
  bulkDeleteSync: _utils["default"]["synchronized"](_bulk.bulkDelete),
  bulkDelete: _utils["default"].promisified(_bulk.bulkDelete)
}, ((0, _applyDecoratedDescriptor2["default"])(_obj, "saveSync", [_dec], (_init = Object.getOwnPropertyDescriptor(_obj, "saveSync"), _init = _init ? _init.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "removeSync", [_dec2], (_init2 = Object.getOwnPropertyDescriptor(_obj, "removeSync"), _init2 = _init2 ? _init2.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init2;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "findSync", [_dec3], (_init3 = Object.getOwnPropertyDescriptor(_obj, "findSync"), _init3 = _init3 ? _init3.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init3;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "findByIdSync", [_dec4], (_init4 = Object.getOwnPropertyDescriptor(_obj, "findByIdSync"), _init4 = _init4 ? _init4.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init4;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "loadRelationsSync", [_dec5], (_init5 = Object.getOwnPropertyDescriptor(_obj, "loadRelationsSync"), _init5 = _init5 ? _init5.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init5;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "findFirstSync", [_dec6], (_init6 = Object.getOwnPropertyDescriptor(_obj, "findFirstSync"), _init6 = _init6 ? _init6.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init6;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "findLastSync", [_dec7], (_init7 = Object.getOwnPropertyDescriptor(_obj, "findLastSync"), _init7 = _init7 ? _init7.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init7;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "getObjectCountSync", [_dec8], (_init8 = Object.getOwnPropertyDescriptor(_obj, "getObjectCountSync"), _init8 = _init8 ? _init8.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init8;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "setRelationSync", [_dec9], (_init9 = Object.getOwnPropertyDescriptor(_obj, "setRelationSync"), _init9 = _init9 ? _init9.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init9;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "addRelationSync", [_dec10], (_init10 = Object.getOwnPropertyDescriptor(_obj, "addRelationSync"), _init10 = _init10 ? _init10.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init10;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "deleteRelationSync", [_dec11], (_init11 = Object.getOwnPropertyDescriptor(_obj, "deleteRelationSync"), _init11 = _init11 ? _init11.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init11;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "bulkCreateSync", [_dec12], (_init12 = Object.getOwnPropertyDescriptor(_obj, "bulkCreateSync"), _init12 = _init12 ? _init12.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init12;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "bulkUpdateSync", [_dec13], (_init13 = Object.getOwnPropertyDescriptor(_obj, "bulkUpdateSync"), _init13 = _init13 ? _init13.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init13;
  }
}), _obj), (0, _applyDecoratedDescriptor2["default"])(_obj, "bulkDeleteSync", [_dec14], (_init14 = Object.getOwnPropertyDescriptor(_obj, "bulkDeleteSync"), _init14 = _init14 ? _init14.value : undefined, {
  enumerable: true,
  configurable: true,
  writable: true,
  initializer: function initializer() {
    return _init14;
  }
}), _obj)), _obj)));
var _default = DataStore;
exports["default"] = _default;