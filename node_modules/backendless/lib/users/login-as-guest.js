"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loginAsGuest = loginAsGuest;

var _utils = _interopRequireDefault(require("../utils"));

var _utils2 = require("./utils");

function loginAsGuest(stayLoggedIn)
/** async */
{
  stayLoggedIn = stayLoggedIn === true;
  this.app.LocalCache.remove('user-token');
  this.app.LocalCache.remove('current-user-id');
  this.app.LocalCache.set('stayLoggedIn', false);

  var responder = _utils["default"].extractResponder(arguments);

  var isAsync = !!responder;

  if (responder) {
    responder = _utils2.wrapAsync.call(this, responder, stayLoggedIn);
  }

  var result = this.app.request.post({
    url: this.app.urls.guestLogin(),
    isAsync: isAsync,
    asyncHandler: responder
  });

  if (!isAsync && result) {
    this.setLocalCurrentUser((0, _utils2.parseResponse)(result, stayLoggedIn));
    result = _utils2.getUserFromResponse.call(this, this.getLocalCurrentUser());
  }

  return result;
}